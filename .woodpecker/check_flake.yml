when:
  # only run when any nix files are modified
  - event: push
    path: [ "flake.nix", "flake.lock", "nix/**" ]

steps:
  - name: check flake
    image: docker.io/nixos/nix
    backend_options:
      kubernetes:
        resources:
          requests:
            cpu: "4"
          limits:
            memory: "8Gi"
    volumes:
      - woodpecker-cache:/woodpecker/src/cache
    environment:
      XDG_CACHE_HOME: /woodpecker/src/cache
    commands:
      - nix --extra-experimental-features "nix-command flakes" flake check

